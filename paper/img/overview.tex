\def\entityWidth{1cm}
\def\entityHDist{2.2cm}
\def\entityVDist{1cm}
\def\onionWidth{.33cm}

\begin{tikzpicture}[
	label/.style = {
		draw=none,
		font=\fontsize{6}{6}\rmfamily,
		text=black,
	},
	edges/.style = {
		draw=black,
		thick,
		-latex,
		rounded corners,
	},
]
	%%%
	% Entities
	%%%
	\node[draw=none](tb){%
		\includegraphics[width=\entityWidth]{img/overview/tb}
	};
	\node[label, below=0pt of tb]{\textbf{Tor Browser}};

	\node[draw, circle, fill=gray!33, right=\entityHDist of tb](ctr){%
		CTR% TODO: add proper CTR figure
	};

	\node[draw=none, right=\entityHDist of ctr](log){%
		\includegraphics[width=\entityWidth]{img/overview/log}
	};
	\node[label, below=0pt of log]{\textbf{CT Log}};

	\node[draw=none, above=\entityVDist of ctr](website){%
		\includegraphics[width=\entityWidth]{img/overview/ws}
	};
	\node[label, above=0pt of website]{\textbf{Website}};

	\node[draw=none, below=\entityVDist of log](auditor){%
		\includegraphics[width=\entityWidth]{img/overview/auditor}
	};
	\node[label, below=0pt of auditor]{\textbf{Auditor}};

	\node[draw=none, right=\entityHDist of website](consensus) {%
		\includegraphics[width=\entityWidth]{img/overview/consensus}
	};
	\node[label, above=0pt of consensus]{\textbf{Tor Consensus}};

	%%%
	% Interactions
	%%%
	\path[edges]
		(website) -|
			node[draw=none, pos=.75]{%
				\includegraphics[width=\onionWidth]{img/overview/onion}
			}
			node[label, above, pos=.25]{1. present SFO}
		(tb);

	\path[edges]
		(tb) --
			node[draw=none, pos=.5]{%
				\includegraphics[width=\onionWidth]{img/overview/onion}
			}
			node[label, above, pos=.5]{2. submit SFO}
		(ctr);

	\path[edges]
		(ctr) --
			node[draw=none, pos=.5]{%
				\includegraphics[width=\onionWidth]{img/overview/onion}
			}
			node[label, above, pos=.5]{3. audit SFO}
		(log);

	\path[edges]
		(ctr) |-
			node[draw=none, pos=.25]{%
				\includegraphics[width=\onionWidth]{img/overview/onion}
			}
			node[label, below, pos=.75]{4. report SFO on timeout}
		(auditor);

	\path[edges, densely dotted]
		($ (consensus) !.20! (ctr) $) --
		($ (consensus) !.45! (ctr) $);
\end{tikzpicture}
